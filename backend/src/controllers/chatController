exports.chat = async (req, res) => {
    const { message, user } = req.body;
  
    if (!message ) {
      return res.status(400).json({ error: 'Utente e messaggio sono obbligatori.' });
    }
  
    try {
      // Crea una nuova conversazione o utilizza una esistente
      const conversation = await Conversation.create({
        user,
        messages: [{ text: message, sender: 'user', timestamp: Date.now() }],
      });
  
      // Risposta del bot
      const botResponse = await chatService.getBotResponse(message);
  
      // Aggiungi la risposta del bot alla conversazione
      conversation.messages.push({
        text: botResponse,
        sender: 'bot',
        timestamp: Date.now(),
      });
  
      // Salva la conversazione aggiornata
      await conversation.save();
  
      res.status(200).json({ botResponse });
    } catch (error) {
      console.error('Errore nella gestione del messaggio:', error);
      res.status(500).json({ error: 'Errore del server.' });
    }
  };
  